(function($){var months={"short":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"long":["January","February","March","April","May","June","July","August","September","October","November","December"]},todayDate=new Date,todayYear=todayDate.getFullYear(),todayMonth=todayDate.getMonth()+1,todayDay=todayDate.getDate();$.fn.birthdaypicker=function(options){var settings={maxAge:120,minAge:0,futureDates:false,maxYear:todayYear,dateFormat:"middleEndian",monthFormat:"short",placeholder:true,legend:"",defaultDate:false,fieldName:"birthdate",fieldId:"birthdate",hiddenDate:true,onChange:null,tabindex:null};return this.each(function(){if(options){$.extend(settings,options)}var $fieldset=$("<fieldset class='birthday-picker'></fieldset>"),$year=$("<select class='birth-year' name='birth[year]'></select>"),$month=$("<select class='birth-month' name='birth[month]'></select>"),$day=$("<select class='birth-day' name='birth[day]'></select>");var updateSelectOptions=function(){var todayDate=new Date,todayYear=todayDate.getFullYear(),todayMonth=todayDate.getMonth()+1,todayDay=todayDate.getDate(),selectedYear=parseInt($year.val(),10),selectedMonth=parseInt($month.val(),10),selectedDay=parseInt($day.val(),10),actMaxDay=new Date(selectedYear,selectedMonth,0).getDate(),curMaxMonth=parseInt($month.children(":last").val(),10),curMaxDay=parseInt($day.children(":last").val(),10);if(curMaxDay>actMaxDay){while(curMaxDay>actMaxDay){$day.children(":last").remove();curMaxDay--}}else if(curMaxDay<actMaxDay){while(curMaxDay<actMaxDay){curMaxDay++;$day.append("<option value="+curMaxDay+">"+curMaxDay+"</option>")}}if(!settings.futureDates&&selectedYear===startYear){if(curMaxMonth>todayMonth){while(curMaxMonth>todayMonth){$month.children(":last").remove();curMaxMonth--}}if(selectedMonth===todayMonth){while(curMaxDay>todayDay){$day.children(":last").remove();curMaxDay-=1}}}if(selectedYear!==startYear&&curMaxMonth!==12){while(curMaxMonth<12){$month.append("<option value="+(curMaxMonth+1)+">"+months[settings.monthFormat][curMaxMonth]+"</option>");curMaxMonth++}}if(selectedYear*selectedMonth*selectedDay!==0){var formattedMonth=(""+selectedMonth).length===1?"0"+selectedMonth:selectedMonth;var formattedDay=(""+selectedDay).length===1?"0"+selectedDay:selectedDay;hiddenDate=selectedYear+"-"+formattedMonth+"-"+formattedDay;$(this).find("#"+settings.fieldId).val(hiddenDate);if(settings.onChange!==null){settings.onChange(hiddenDate)}}};if(settings.legend){$("<legend>"+settings.legends+"</legend>").appendTo($fieldset)}var tabindex=settings.tabindex;if(settings.dateFormat==="bigEndian"){$fieldset.append($year).append($month).append($day);if(tabindex!==null){$year.attr("tabindex",tabindex);$month.attr("tabindex",tabindex++);$day.attr("tabindex",tabindex++)}}else if(settings.dateFormat==="littleEndian"){$fieldset.append($day).append($month).append($year);if(tabindex!==null){$day.attr("tabindex",tabindex);$month.attr("tabindex",tabindex++);$year.attr("tabindex",tabindex++)}}else{$fieldset.append($month).append($day).append($year);if(tabindex!==null){$month.attr("tabindex",tabindex);$day.attr("tabindex",tabindex++);$year.attr("tabindex",tabindex++)}}if(settings.placeholder){$("<option value='0'>Year:</option>").appendTo($year);$("<option value='0'>Month:</option>").appendTo($month);$("<option value='0'>Day:</option>").appendTo($day)}var hiddenDate;if(settings.defaultDate){var defDate=new Date(settings.defaultDate+"T00:00:00"),defYear=defDate.getFullYear(),defMonth=(""+(defDate.getMonth()+1)).length===1?"0"+(defDate.getMonth()+1):defDate.getMonth()+1,defDay=(""+defDate.getDate()).length===1?"0"+defDate.getDate():defDate.getDate();hiddenDate=defYear+"-"+defMonth+"-"+defDay}if(settings.hiddenDate){$("<input type='hidden' name='"+settings.fieldName+"'/>").attr("id",settings.fieldId).val(hiddenDate).appendTo($fieldset)}var startYear=todayYear-settings.minAge;var endYear=todayYear-settings.maxAge;if(settings.futureDates&&settings.maxYear!==todayYear){if(settings.maxYear>1e3){startYear=settings.maxYear}else{startYear=todayYear+settings.maxYear}}var i,j,k;for(i=startYear;i>=endYear;i--){$("<option></option>").attr("value",i).text(i).appendTo($year)}for(j=0;j<12;j++){$("<option></option>").attr("value",j+1).text(months[settings.monthFormat][j]).appendTo($month)}for(k=1;k<32;k++){$("<option></option>").attr("value",k).text(k).appendTo($day)}$(this).append($fieldset);if(settings.defaultDate){var date=new Date(settings.defaultDate+"T00:00:00");$year.val(date.getFullYear());$month.val(date.getMonth()+1);$day.val(date.getDate());updateSelectOptions()}$fieldset.change(updateSelectOptions)})}})(jQuery);